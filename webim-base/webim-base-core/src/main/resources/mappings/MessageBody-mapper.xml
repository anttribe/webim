<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.anttribe.webim.base.core.domain.MessageBody">
	<cache readOnly="true" />
	<resultMap id="MessageBody-resultMap"
		type="org.anttribe.webim.base.core.domain.MessageBody">
		<result property="messageBodyId" column="id" />
		<result property="messageType" column="messate_type" />
		<result property="msg" column="msg" />
		<result property="filename" column="filename" />
		<result property="hxFileUrl" column="hx_file_url" />
		<result property="duration" column="duration" />
		<result property="fileLength" column="file_length" />
		<result property="secret" column="secret" />
		<result property="hxThumbUrl" column="hx_thumb_url" />
		<result property="thumbSecret" column="thumb_secret" />
		<result property="filepath" column="filepath" />
		<result property="thumbpath" column="thumbpath" />
		<result property="address" column="address" />
		<result property="lat" column="lat" />
		<result property="lng" column="lng" />
		<!-- <association property="message" column="{id = message_id}" -->
		<!-- javaType="org.anttribe.webim.base.core.domain.Message" select="org.anttribe.webim.base.core.domain.Message.queryById" 
			/> -->
	</resultMap>

	<!-- insert: 插入单条数据 -->
	<insert id="insert" parameterType="org.anttribe.webim.base.core.domain.MessageBody">
		<![CDATA[
		insert into t_webim_messagebody(id, messate_type, msg, filename, hx_file_url, duration, file_length, secret, hx_thumb_url, thumb_secret, filepath, thumbpath, address, lat, lng, message_id)
		    values(#{messageBodyId}, #{messageType}, #{msg}, #{filename}, #{hxFileUrl}, #{duration}, #{fileLength}, #{secret}, #{hxThumbUrl}, #{thumbSecret}, #{filepath}, #{thumbpath}, #{address}, #{lat}, #{lng}, #{message.messageId})
		]]>
	</insert>

	<!-- batchInsert: 批量插入数据 -->
	<insert id="batchInsert" parameterType="java.util.List">
		<![CDATA[
		insert into t_webim_messagebody(id, messate_type, msg, filename, hx_file_url, duration, file_length, secret, hx_thumb_url, thumb_secret, filepath, thumbpath, address, lat, lng, message_id)
		values
		]]>
		<foreach collection="list" item="item" separator=", ">
			(#{item.messageBodyId},
			#{item.messageType}, #{item.msg},
			#{item.filename},
			#{item.hxFileUrl},
			#{item.duration},
			#{item.fileLength}, #{item.secret},
			#{item.hxThumbUrl},
			#{item.thumbSecret}, #{item.filepath},
			#{item.thumbpath},
			#{item.address}, #{item.lat}, #{item.lng},
			#{item.message.messageId})
		</foreach>
	</insert>

	<!-- queryAll: 查询所有数据 -->
	<select id="queryAll" resultMap="MessageBody-resultMap">
		<![CDATA[
		]]>
	</select>

	<!-- queryById: 根据id查询单条数据 -->
	<select id="queryById" resultMap="MessageBody-resultMap">
		<![CDATA[
		]]>
	</select>

	<!-- queryByCriteria: 根据条件查询数据 -->
	<select id="queryByCriteria" resultMap="MessageBody-resultMap"
		parameterType="map">
		<![CDATA[
		]]>
	</select>

	<!-- queryByMessage: 根据message查询数据 -->
	<select id="queryByMessage" resultMap="MessageBody-resultMap"
		parameterType="java.util.Map">
		<![CDATA[
		select id, messate_type, msg, filename, hx_file_url, duration, file_length, secret, hx_thumb_url, thumb_secret, filepath, thumbpath, address, lat, lng, message_id
		    from t_webim_messagebody
		    where message_id = #{messageId}
		]]>
	</select>

	<!-- queryFileMessageBodies: 查询所有文件类型消息的消息体 -->
	<select id="queryFileMessageBodies" resultMap="MessageBody-resultMap"
		parameterType="java.util.Map">
		<![CDATA[
		select id, messate_type, msg, filename, hx_file_url, duration, file_length, secret, hx_thumb_url, thumb_secret, filepath, thumbpath, address, lat, lng, message_id
		    from t_webim_messagebody
		    where (messate_type = 'File' or messate_type = 'Audio' or messate_type = 'Image')
		      and hx_file_url is not null
		      and secret is not null
		      and filepath is null
		]]>
	</select>
</mapper>